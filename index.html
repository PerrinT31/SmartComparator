<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TopTex – Smart Comparator (démo statique)</title>
  <style>
    :root { --bg:#f6f7f9; --card:#fff; --text:#0f172a; --muted:#64748b; --brand:#1f51a8; --ok:#12a150; --warn:#eab308; --bad:#dc2626; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);font-family:Inter,system-ui,Arial,sans-serif;color:var(--text)}
    header{padding:28px 20px}
    .wrap{max-width:1080px;margin:0 auto}
    h1{margin:0 0 4px;font-size:26px;font-weight:700}
    p.lead{margin:0;color:var(--muted)}
    .panel{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .grid{display:grid;gap:12px}
    @media(min-width:900px){ .grid-3{grid-template-columns:repeat(3,1fr)} .grid-2{grid-template-columns:1.3fr .7fr} }
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input,select,button{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;background:#fff;font:inherit}
    input:focus,select:focus{outline:2px solid rgba(31,81,168,.2);border-color:var(--brand)}
    .btn{background:var(--brand);color:#fff;border:none;cursor:pointer;font-weight:600}
    .btn:hover{filter:brightness(1.05)}
    .cards{display:grid;gap:14px}
    @media(min-width:900px){ .cards{grid-template-columns:repeat(3,1fr)} }
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:10px}
    .title{font-weight:700}
    .meta{color:var(--muted);font-size:13px}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#eef2ff;color:#334155;font-size:12px;margin-right:6px;margin-top:4px}
    .score{font-weight:800;font-size:22px}
    .score.ok{color:var(--ok)} .score.mid{color:var(--warn)} .score.bad{color:var(--bad)}
    .hint{font-size:12px;color:var(--muted)}
    footer{padding:32px 20px;color:var(--muted);text-align:center}
    .badge{display:inline-block;font-size:11px;border:1px solid #e5e7eb;border-radius:999px;padding:2px 8px;margin-right:6px;color:#334155;background:#f9fafb}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Smart Comparator – Démo statique</h1>
      <p class="lead">Comparer des T-shirts, sweats et polos (qualité / prix / dispo / délais) pour trouver la meilleure option.</p>
    </div>
  </header>

  <main class="wrap" style="display:grid;gap:14px;padding:0 20px 28px">
    <section class="panel grid grid-2" aria-label="Recherche">
      <div class="grid" style="align-content:start">
        <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px">
          <div>
            <label for="qty">Quantité</label>
            <input id="qty" type="number" min="1" value="200" />
          </div>
          <div>
            <label for="deadline">Livrable avant</label>
            <input id="deadline" type="date" />
          </div>
        </div>
        <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px">
          <div>
            <label for="color">Couleur souhaitée</label>
            <select id="color">
              <option value="">Toutes</option>
              <option>Blanc</option>
              <option>Noir</option>
              <option>Marine</option>
              <option>Bleu</option>
              <option>Gris chiné</option>
              <option>Beige</option>
            </select>
          </div>
          <div>
            <label for="size">Taille</label>
            <select id="size">
              <option value="">Toutes</option>
              <option>XS</option>
              <option>S</option>
              <option>M</option>
              <option>L</option>
              <option>XL</option>
              <option>XXL</option>
            </select>
          </div>
        </div>
        <div>
          <label for="query">Mot-clé (ex. “polo bio”, “sport”, “oversize”)</label>
          <input id="query" type="text" placeholder="ex. polo blanc, sport, bio..." />
        </div>
        <div class="hint">Astuce : laisse vide pour comparer tous les produits de test.</div>
      </div>

      <div class="grid" style="align-content:end">
        <button id="search" class="btn">Comparer maintenant</button>
        <div class="panel" style="background:#f9fafb">
          <label>Pondérations du score</label>
          <div class="grid" style="grid-template-columns:1fr 1fr 1fr;gap:10px">
            <input id="wQuality" type="number" min="0" max="100" value="40" title="Qualité %" />
            <input id="wPrice"   type="number" min="0" max="100" value="35" title="Prix %" />
            <input id="wAvail"   type="number" min="0" max="100" value="25" title="Disponibilité %" />
          </div>
          <div class="hint">La somme doit faire 100. (Pour la démo, on normalise automatiquement.)</div>
        </div>
      </div>
    </section>

    <section class="panel" aria-label="Filtres actifs">
      <span class="badge" id="badge-count">3 meilleurs résultats</span>
      <span class="badge" id="badge-info">Score = Qualité 40% • Prix 35% • Dispo 25%</span>
    </section>

    <section class="cards" id="results" aria-live="polite"></section>
  </main>

  <footer>Démo statique pour présentation interne – TopTex • Aucune donnée réelle utilisée.</footer>

  <script>
    // ------------------------------
    // 1) Produits de DÉMO (9 items)
    // ------------------------------
    const PRODUCTS = [
      // --- T-shirts ---
      { id:"ns310-bio", name:"T-shirt Native Spirit Bio NS310", category:"tshirt",
        price:6.9, quality:88, stock:2100, leadTimeDays:3,
        labels:["GOTS","OEKO-TEX"], colors:["Blanc","Noir","Marine"], sizes:["XS","S","M","L","XL","XXL"],
        keywords:"t shirt coton bio unisexe blanc durable" },
      { id:"kb305-heavy", name:"T-shirt Kariban Heavy KB305", category:"tshirt",
        price:5.8, quality:85, stock:1400, leadTimeDays:2,
        labels:["OEKO-TEX"], colors:["Noir","Blanc","Bleu"], sizes:["S","M","L","XL","XXL"],
        keywords:"t shirt épais coton 190g homme noir robuste" },
      { id:"pro200-tech", name:"T-shirt Proact Tech PRO200", category:"tshirt",
        price:7.5, quality:90, stock:800, leadTimeDays:4,
        labels:["OEKO-TEX"], colors:["Bleu","Noir","Gris chiné"], sizes:["S","M","L","XL"],
        keywords:"t shirt sport respirant polyester bleu running training" },

      // --- Sweats ---
      { id:"ns720-relax", name:"Sweat Native Spirit Relax NS720", category:"sweat",
        price:21.5, quality:95, stock:450, leadTimeDays:5,
        labels:["GRS","VEGAN"], colors:["Marine","Noir","Gris chiné"], sizes:["S","M","L","XL","XXL"],
        keywords:"sweat oversize coton recyclé marine lifestyle" },
      { id:"kb420-classic", name:"Sweat Kariban Classic KB420", category:"sweat",
        price:18.9, quality:90, stock:950, leadTimeDays:3,
        labels:["OEKO-TEX"], colors:["Noir","Gris chiné","Bleu"], sizes:["S","M","L","XL","XXL"],
        keywords:"sweat unisexe col rond coton molleton classique" },
      { id:"pro500-zip", name:"Sweat Proact Zip PRO500", category:"sweat",
        price:23.4, quality:92, stock:370, leadTimeDays:6,
        labels:["OEKO-TEX"], colors:["Gris chiné","Noir","Bleu"], sizes:["S","M","L","XL"],
        keywords:"sweat technique sport zippé gris chiné performance" },

      // --- Polos ---
      { id:"kb300-bio", name:"Polo Kariban Bio KB300", category:"polo",
        price:9.8, quality:90, stock:1100, leadTimeDays:3,
        labels:["GOTS","OEKO-TEX"], colors:["Blanc","Marine","Noir"], sizes:["S","M","L","XL","XXL"],
        keywords:"polo bio coton organique blanc no label personnalisation" },
      { id:"kb400-premium", name:"Polo Kariban Premium KB400", category:"polo",
        price:12.4, quality:93, stock:680, leadTimeDays:5,
        labels:["OEKO-TEX"], colors:["Bleu","Noir","Blanc"], sizes:["S","M","L","XL","XXL"],
        keywords:"polo homme piqué double fil bleu premium" },
      { id:"pro701-active", name:"Polo Proact Active PRO701", category:"polo",
        price:10.9, quality:88, stock:1500, leadTimeDays:4,
        labels:["OEKO-TEX"], colors:["Noir","Bleu","Blanc"], sizes:["S","M","L","XL"],
        keywords:"polo sport respirant polyester noir club équipe" }
    ];

    // ------------------------------
    // 2) Utilitaires score & format
    // ------------------------------
    function clamp01(x){ return Math.max(0, Math.min(1, x)); }
    function daysUntil(dateStr){
      if(!dateStr) return Infinity;
      const d = new Date(dateStr);
      const today = new Date(); today.setHours(0,0,0,0);
      const diff = Math.ceil((d - today)/(1000*60*60*24));
      return diff < 0 ? -1 : diff;
    }
    function formatEUR(n){ return n.toLocaleString("fr-FR",{style:"currency",currency:"EUR"}); }
    function scoreProduct(p, weights){
      // Normalisations simples pour la démo
      const priceNorm = clamp01(1 - p.price / 30);              // 0€ -> 1 ; 30€ -> 0
      const qualityNorm = clamp01(p.quality / 100);             // 0-100 -> 0-1
      const availNorm = clamp01(p.stock / 1200) * clamp01(1 - (p.leadTimeDays / 14)); // stock élevé + délai court
      const s = qualityNorm*weights.quality + priceNorm*weights.price + availNorm*weights.availability;
      return Math.round(s * 100);
    }
    function scoreClass(v){ return v>=80 ? "ok" : v>=60 ? "mid" : "bad"; }

    // ------------------------------
    // 3) Filtrage & tri
    // ------------------------------
    function compute(query, qty, deadline, weights, color, size){
      const days = daysUntil(deadline);
      const q = (query||"").trim().toLowerCase();
      return PRODUCTS
        .filter(p=>{
          const matchesQuery = !q || p.name.toLowerCase().includes(q) || p.keywords.toLowerCase().includes(q);
          const enoughStock = qty ? p.stock >= qty : true;
          const meetDeadline = (days === Infinity) ? true : (p.leadTimeDays <= days && days >= 0);
          const matchColor = !color || (p.colors && p.colors.includes(color));
          const matchSize = !size || (p.sizes && p.sizes.includes(size));
          return matchesQuery && enoughStock && meetDeadline && matchColor && matchSize;
        })
        .map(p=>({ ...p, score: scoreProduct(p, weights) }))
        .sort((a,b)=> b.score - a.score)
        .slice(0,3);
    }

    // ------------------------------
    // 4) Rendu UI
    // ------------------------------
    const elResults = document.getElementById("results");
    const elBadgeCount = document.getElementById("badge-count");
    const elBadgeInfo  = document.getElementById("badge-info");

    function render(list, weights){
      elResults.innerHTML = "";
      elBadgeCount.textContent = list.length ? `${list.length} meilleurs résultats` : "Aucun résultat";
      elBadgeInfo.textContent = `Score = Qualité ${(weights.quality*100)|0}% • Prix ${(weights.price*100)|0}% • Dispo ${(weights.availability*100)|0}%`;

      if(!list.length){
        elResults.innerHTML = `<div class="panel">Aucun résultat avec ces critères. Essaie d'élargir la recherche (couleur/taille, délai ou quantité).</div>`;
        return;
      }

      list.forEach(p=>{
        const lbls = p.labels.map(l=>`<span class="pill">${l}</span>`).join("");
        const colors = p.colors.map(c=>`<span class="badge">${c}</span>`).join("");
        const sizes  = p.sizes.map(s=>`<span class="badge">${s}</span>`).join("");
        elResults.insertAdjacentHTML("beforeend", `
          <article class="card" aria-label="${p.name}">
            <div class="title">${p.name}</div>
            <div class="meta">ID: ${p.id} · Catégorie: ${p.category}</div>

            <div class="grid" style="grid-template-columns:1fr 1fr;gap:8px">
              <div><label>Prix</label><div><strong>${formatEUR(p.price)}</strong> / pièce</div></div>
              <div><label>Stock</label><div><strong>${p.stock}</strong> dispo</div></div>
              <div><label>Délai estimé</label><div><strong>${p.leadTimeDays} j</strong></div></div>
              <div><label>Qualité (démo)</label><div><strong>${p.quality}/100</strong></div></div>
            </div>

            <div><label>Labels</label><div>${lbls || "<span class='meta'>—</span>"}</div></div>
            <div><label>Couleurs</label><div>${colors}</div></div>
            <div><label>Tailles</label><div>${sizes}</div></div>
            <div><label>Score</label><div class="score ${scoreClass(p.score)}">${p.score}/100</div></div>

            <button class="btn" onclick="alert('Démo: génération de devis à venir')">Générer mon devis</button>
          </article>
        `);
      });
    }

    // ------------------------------
    // 5) Interactions
    // ------------------------------
    const $ = id => document.getElementById(id);
    function getWeights(){
      const q = parseFloat($("wQuality").value||0)/100;
      const p = parseFloat($("wPrice").value||0)/100;
      const a = parseFloat($("wAvail").value||0)/100;
      const sum = (q+p+a) || 1;
      return { quality: q/sum, price: p/sum, availability: a/sum };
    }
    function run(){
      const list = compute(
        $("query").value,
        parseInt($("qty").value || 0, 10),
        $("deadline").value,
        getWeights(),
        $("color").value,
        $("size").value
      );
      render(list, getWeights());
    }

    // Init : deadline à +7 jours pour la démo
    const d = new Date(); d.setDate(d.getDate()+7); $("deadline").value = d.toISOString().slice(0,10);
    run();
    $("search").addEventListener("click", run);

    // Recalculer à la volée quand l'utilisateur change les pondérations ou filtres
    ["wQuality","wPrice","wAvail","color","size","qty","deadline","query"].forEach(id=>{
      $(id).addEventListener("change", run);
      $(id).addEventListener("keyup", e => { if(id==="query") run(); });
    });
  </script>
</body>
</html>
